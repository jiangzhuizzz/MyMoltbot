# 抖音开放平台接入指南

## 一、注册企业账号

### 1. 注册抖音开放平台
1. 访问 [抖音开放平台](https://open.douyin.com/)
2. 注册企业账号（需要营业执照）
3. 完成企业认证

### 2. 创建应用

进入控制台 → 应用管理 → 创建应用：

| 字段 | 填写建议 |
|------|----------|
| 应用名称 | 贷款服务助手 |
| 应用类型 | 工具类 |
| 简介 | 贷款产品查询与咨询服务 |
| 资质 | 营业执照、ICP备案 |

### 3. 申请API权限

需要的权限：

| API | 用途 | 申请难度 |
|-----|------|----------|
| 搜索接口 | 搜索贷款相关视频/用户 | ⭐⭐ |
| 私信接口 | 发送私信触达客户 | ⭐⭐⭐⭐ |
| 评论接口 | 评论区互动 | ⭐⭐⭐ |

## 二、API文档

### 1. 搜索接口

```
GET https://open.douyin.com/api/douyin/v1/video/search/
```

参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| keyword | string | 是 | 搜索关键词 |
| cursor | int | 否 | 分页游标 |
| count | int | 否 | 每页数量(最大20) |

响应示例：

```json
{
  "data": {
    "videos": [
      {
        "video_id": "v03010400000",
        "title": "征信逾期能贷款吗？急！",
        "desc": "之前信用卡逾期过几次...",
        "create_time": 1640995200,
        "author": {
          "nickname": "武汉租房小王",
          "sec_uid": "MS4wLjABAAA..."
        }
      }
    ],
    "cursor": 0,
    "has_more": true
  }
}
```

### 2. 私信接口

```
POST https://open.douyin.com/api/douyin/v1/message/send/
```

参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| receiver_id | string | 是 | 接收者open_id |
| content | string | 是 | 私信内容(最长500字) |
| msg_type | int | 是 | 消息类型(1=文本) |

### 3. 评论接口

```
POST https://open.douyin.com/api/douyin/v1/comment/send/
```

参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| item_id | string | 是 | 视频ID |
| content | string | 是 | 评论内容 |

## 三、Python接入示例

```python
import requests
from urllib.parse import urlencode

class DouyinOpenPlatform:
    """抖音开放平台"""
    
    def __init__(self, client_key, client_secret):
        self.client_key = client_key
        self.client_secret = client_secret
        self.access_token = None
        self.base_url = "https://open.douyin.com/api/douyin/v1"
    
    def get_access_token(self):
        """获取access_token"""
        url = f"https://open.douyin.com/oauth/client_token/"
        data = {
            "client_key": self.client_key,
            "client_secret": self.client_secret,
            "grant_type": "client_credential"
        }
        resp = requests.post(url, data=data)
        if resp.status_code == 200:
            self.access_token = resp.json().get("data", {}).get("access_token")
            return self.access_token
        return None
    
    def search_videos(self, keyword, cursor=0, count=10):
        """搜索视频"""
        url = f"{self.base_url}/video/search/"
        params = {
            "access_token": self.access_token,
            "keyword": keyword,
            "cursor": cursor,
            "count": count
        }
        resp = requests.get(f"{url}?{urlencode(params)}")
        return resp.json()
    
    def send_private_msg(self, receiver_id, content):
        """发送私信"""
        url = f"{self.base_url}/message/send/"
        data = {
            "access_token": self.access_token,
            "receiver_id": receiver_id,
            "content": content,
            "msg_type": 1
        }
        resp = requests.post(url, data=data)
        return resp.json()
    
    def send_comment(self, item_id, content):
        """发送评论"""
        url = f"{self.base_url}/comment/send/"
        data = {
            "access_token": self.access_token,
            "item_id": item_id,
            "content": content
        }
        resp = requests.post(url, data=data)
        return resp.json()


# 使用示例
if __name__ == "__main__":
    # 配置
    CLIENT_KEY = "your_client_key"
    CLIENT_SECRET = "your_client_secret"
    
    # 初始化
    dy = DouyinOpenPlatform(CLIENT_KEY, CLIENT_SECRET)
    token = dy.get_access_token()
    
    # 搜索视频
    result = dy.search_videos("贷款")
    print(result)
```

## 四、注意事项

### 1. 审核要求
- 私信功能需要额外申请
- 可能需要提供业务资质
- 审核周期3-7天

### 2. 频率限制
- 搜索：100次/分钟
- 私信：100次/小时
- 评论：50次/小时

### 3. 内容规范
- 私信内容不能包含联系方式
- 不能频繁发送相同内容
- 需要用户授权才能发送

## 五、替代方案（无API）

如果API申请困难，可以使用：

### 1. 抖音评论区爬取
```python
# 爬取视频评论区
def get_douyin_comments(video_url):
    # 使用selenium/playwright
    pass
```

### 2. 抖音热点话题
```python
# 监控贷款相关话题
def monitor_douyin_topics():
    pass
```

## 六、常见问题

### Q: 企业认证需要什么？
A: 营业执照、对公账户、法人信息

### Q: API申请被拒怎么办？
A: 调整应用类型为"工具类"，减少敏感权限申请

### Q: 私信功能如何绕过审核？
A: 无法绕过，建议使用"替代方案"中的爬取方式

### Q: 如何获取用户ID？
A: 需要用户在你的应用授权后才能获取
